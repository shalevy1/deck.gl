<!DOCTYPE html>
<html>
<head>
  <style type="text/css">
    body {padding: 0; margin: 0;}
    #app {width: 100vw; height: 100vh; overflow: hidden;}
  </style>
</head>
<body>
  <div id="app"></div>
  <script src="/modules/jupyter-widget/dist/index.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.js"></script>
  <script type="text/javascript">

define('@jupyter-widgets/base', function() {
  return {
    DOMWidgetModel: function() {},
    DOMWidgetView: function() {}
  };
});

const DEPENDENCIES = {
    '@deck.gl/jupyter-widget': '/modules/jupyter-widget/dist/index',
}

requirejs.config(DEPENDENCIES);

function render(jsonInput) {
  requirejs(['@deck.gl/jupyter-widget'], (root) => {
    root.createDeckWithImports({
      mapboxApiKey: 'NO_API_KEY', 
      container: document.getElementById('app'),
      jsonInput,
      useTooltip: true,
      onComplete: ({deckgl}) => {
        deckgl.setProps({
          onAfterRender: () => window.top.postMessage('done')
        });
      }
    });
  })
}

window.onmessage = evt => {
  if (evt.data.json) {
    render(evt.data.json);
  }
};

  </script>
</body>
</html>
